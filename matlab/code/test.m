Hp = [1.8026 1.5528 -776.3982;
-0.8100 2.1330 -107.9100;
0.0006 0.0008 1.0000];

src = [141, 131;480, 159 ;493, 630;64, 601];
dest = [318, 256;534, 372;316, 670;73, 473];

p2 = src';
p1=dest';

p1(3,:) = 1;
p2(3,:) = 1;

new_p2 = Hp * p1;
new_p2(1,:) = new_p2(1,:)./new_p2(3,:);
new_p2(2,:) = new_p2(2,:)./new_p2(3,:);
new_p2(3,:) = new_p2(3,:)./new_p2(3,:);

x = p1(1,:);
y = p1(2,:);
xp = p2(1,:);
yp = p2(2,:);

P = [
    x(1) y(1) 1 0 0 0 -x(1)*xp(1) -y(1)*xp(1) -xp(1);
    0 0 0 x(1) y(1) 1 -x(1)*yp(1) -y(1)*yp(1) -yp(1);
    x(2) y(2) 1 0 0 0 -x(2)*xp(2) -y(2)*xp(2) -xp(2);
    0 0 0 x(2) y(2) 1 -x(2)*yp(2) -y(2)*yp(2) -yp(2);
    x(3) y(3) 1 0 0 0 -x(3)*xp(3) -y(3)*xp(3) -xp(3);
    0 0 0 x(3) y(3) 1 -x(3)*yp(3) -y(3)*yp(3) -yp(3);
    x(4) y(4) 1 0 0 0 -x(4)*xp(4) -y(4)*xp(4) -xp(4);
    0 0 0 x(4) y(4) 1 -x(4)*yp(4) -y(4)*yp(4) -yp(4);
    ];

[U,S,V] = svd(P);
H = reshape(V(:, 9), [3,3])';

H = H./H(3,3);

